@{
    ViewData["Title"] = "CDR List";
    var today = DateTime.Now.ToString("yyyy-MM-dd");
    var yesterday = DateTime.Now.AddDays(-1).ToString("yyyy-MM-dd");
}

<div class="container mt-5">
    <h2 class="mb-4">CDR List</h2>

    <form id="cdrForm" class="needs-validation" novalidate>
        <div class="row">
            <div class="col-md-5 mb-3">
                <label for="startDate">Start Date</label>
                <input type="date" class="form-control" id="startDate" name="startDate" required value="@yesterday" />
                <div class="invalid-feedback">
                    Please select a start date.
                </div>
            </div>
            <div class="col-md-5 mb-3">
                <label for="endDate">End Date</label>
                <input type="date" class="form-control" id="endDate" name="endDate" required value="@today" />
                <div class="invalid-feedback">
                    Please select an end date.
                </div>
            </div>
        </div>
        <button class="btn btn-primary" type="submit">Get CDR List</button>
    </form>

    <div id="result" class="mt-4"></div>
</div>

@section Scripts {
    <script>
        document.getElementById("cdrForm").addEventListener("submit", function (event) {
            event.preventDefault();

            const startDate = document.getElementById("startDate").value;
            const endDate = document.getElementById("endDate").value;

            fetch(`/Calls/CdrListData?startDate=${startDate}&endDate=${endDate}`)
                .then(response => response.json())
                .then(data => {
                    const resultDiv = document.getElementById("result");
                    if (data.success) {
                        resultDiv.textContent = JSON.stringify(data.data, null, 2);
                        resultDiv.className = "alert alert-success";
                    } else {
                        resultDiv.textContent = data.message;
                        resultDiv.className = "alert alert-danger";
                    }
                })
                .catch(error => {
                    console.error("Error fetching data:", error);
                });
        });
    </script>
}
